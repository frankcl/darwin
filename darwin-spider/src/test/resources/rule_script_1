import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import xin.manong.darwin.common.parser.ParseRequest;
import xin.manong.darwin.common.parser.ParseResponse;
import xin.manong.darwin.parse.parser.Parser;

class WebParser extends Parser {

    @Override
    public ParseResponse parse(ParseRequest request) {
        Map<String, Object> structureMap = new HashMap<>();
        Document document = Jsoup.parse(request.content, request.record.url);
        if (document == null) {
            logger.error("parse content failed");
            return ParseResponse.buildErrorResponse("解析失败");
        }
        Element body = document.body();
        if (body == null) {
            logger.error("body is not found");
            return ParseResponse.buildErrorResponse("body元素缺失");
        }
        Elements elements = body.select("div.main div.col-1 > h1");
        if (elements != null && elements.size() > 0) {
            structureMap.put("title", elements.get(0).text());
        } else {
            logger.warn("title element is not found");
        }
        return ParseResponse.buildStructureResponse(structureMap, null);
    }
}